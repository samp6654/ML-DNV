
# Import Required Libraries
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from statsmodels.tsa.seasonal import seasonal_decompose
from statsmodels.tsa.arima.model import ARIMA
from sklearn.metrics import mean_squared_error
import warnings
warnings.filterwarnings("ignore")

# Import the Dataset
df = pd.read_csv("Stock_Prices.csv")

# Display first few rows
print("Preview of the dataset:")
display(df.head())

# Explore the dataset
print("\nDataset Info:")
df.info()

print("\nStatistical Summary:")
display(df.describe())

print("\nColumns in Dataset:")
print(df.columns)

# Ensure 'Date' column is in datetime format
df['Date'] = pd.to_datetime(df['Date'])
df = df.sort_values(by='Date')  # sort chronologically
df.set_index('Date', inplace=True)  # set Date as index for time series analysis

print("\nDate column converted to datetime and set as index.")

# Line Chart – Historical Stock Price Trend
plt.figure(figsize=(12,6))
plt.plot(df.index, df['Close'], color='blue', linewidth=2)
plt.title("Stock Closing Price Over Time", fontsize=14, fontweight='bold')
plt.xlabel("Date")
plt.ylabel("Closing Price")
plt.grid(True)
plt.show()

# Moving Averages (Rolling Mean)
df['MA_20'] = df['Close'].rolling(window=20).mean()  # 20-day moving average
df['MA_50'] = df['Close'].rolling(window=50).mean()  # 50-day moving average

plt.figure(figsize=(12,6))
plt.plot(df.index, df['Close'], label='Close', color='blue')
plt.plot(df.index, df['MA_20'], label='20-Day MA', color='red', linestyle='--')
plt.plot(df.index, df['MA_50'], label='50-Day MA', color='green', linestyle='--')
plt.title("Moving Averages on Stock Prices", fontsize=14, fontweight='bold')
plt.xlabel("Date")
plt.ylabel("Price")
plt.legend()
plt.grid(True)
plt.show()

# Seasonality Analysis (Decomposition)
# Assuming daily data
decomposition = seasonal_decompose(df['Close'], model='additive', period=30)
fig = decomposition.plot()
fig.set_size_inches(12,8)
plt.suptitle("Seasonal Decomposition of Stock Prices", fontsize=14, fontweight='bold')
plt.show()

# Correlation Analysis – Price vs Volume
plt.figure(figsize=(8,6))
sns.scatterplot(x=df['Volume'], y=df['Close'], alpha=0.6, color='teal')
plt.title("Correlation between Volume and Closing Price", fontsize=14, fontweight='bold')
plt.xlabel("Trading Volume")
plt.ylabel("Closing Price")
plt.grid(True)
plt.show()

corr = df['Volume'].corr(df['Close'])
print(f"\nCorrelation between Volume and Closing Price: {corr:.3f}")

# Forecasting using ARIMA Model
# Split data into training and testing sets
train_size = int(len(df) * 0.8)
train, test = df['Close'][:train_size], df['Close'][train_size:]

# Fit ARIMA model
model = ARIMA(train, order=(5,1,0))  # p,d,q = (5,1,0) is a common starting point
model_fit = model.fit()

# Forecast
forecast = model_fit.forecast(steps=len(test))
test_dates = test.index

# Plot forecast vs actual
plt.figure(figsize=(12,6))
plt.plot(train.index, train, label='Train', color='blue')
plt.plot(test_dates, test, label='Actual', color='black')
plt.plot(test_dates, forecast, label='Forecast', color='red', linestyle='--')
plt.title("ARIMA Forecast vs Actual Stock Prices", fontsize=14, fontweight='bold')
plt.xlabel("Date")
plt.ylabel("Closing Price")
plt.legend()
plt.grid(True)
plt.show()

# Evaluate the model
mse = mean_squared_error(test, forecast)
rmse = np.sqrt(mse)
print(f"\nModel Evaluation Metrics:")
print(f"Mean Squared Error (MSE): {mse:.2f}")
print(f"Root Mean Squared Error (RMSE): {rmse:.2f}")

#  Optional: Forecast Future Prices
future_steps = 30  # forecast for next 30 days
future_forecast = model_fit.forecast(steps=future_steps)

plt.figure(figsize=(12,6))
plt.plot(df.index, df['Close'], label='Historical', color='blue')
plt.plot(pd.date_range(df.index[-1], periods=future_steps+1, freq='D')[1:], 
         future_forecast, label='Future Forecast', color='red', linestyle='--')
plt.title("Future Stock Price Forecast (Next 30 Days)", fontsize=14, fontweight='bold')
plt.xlabel("Date")
plt.ylabel("Predicted Closing Price")
plt.legend()
plt.grid(True)
plt.show()

print("\n Time series analysis and forecasting completed successfully!")
